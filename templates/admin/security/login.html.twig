{% extends 'admin/auth_base.html.twig' %}

{% block page_title %}
	{{ 'auth.login.page_title'|trans }}
{% endblock %}

{% block auth_title %}
	<img width="200" src="{{asset('images/logo.png') }}" alt="{{setting('siteName')}}">
{% endblock %}

{% block auth_subtitle %}
	{{ 'auth.login.access_account'|trans }}
{% endblock %}

{% block auth_content %}
	<form
		method="post" id="loginForm" novalidate>
		<!-- CSRF Token -->
		<input
		type="hidden" name="_csrf_token" data-controller="csrf-protection" value="{{ csrf_token('authenticate') }}">

		<!-- Username/Email Field -->
		<div class="form-floating mb-3">
			<input type="email" class="form-control" id="username" name="email" value="{{ last_username }}" placeholder="name@example.com" required autocomplete="email">
			<label for="username">
				<i class="fas fa-envelope me-2"></i>
				{{ 'auth.login.email_address'|trans }}
			</label>
			<div class="invalid-feedback">
				{{ 'auth.login.email_error'|trans }}
			</div>
		</div>

		<!-- Password Field -->
		<div class="form-floating mb-3">
			<input type="password" class="form-control" id="password" name="password" placeholder="{{ 'auth.login.password'|trans }}" required autocomplete="current-password">
			<label for="password">
				<i class="fas fa-lock me-2"></i>
				{{ 'auth.login.password'|trans }}
			</label>
			<div class="invalid-feedback">
				{{ 'auth.login.password_error'|trans }}
			</div>
		</div>

		
		<!-- Submit Button -->
		<button type="submit" class="btn btn-auth" id="submitBtn">
			<span class="submit-text">
				<i class="fas fa-sign-in-alt me-2"></i>
				{{ 'auth.login.sign_in'|trans }}
			</span>
			<span class="loading-text" style="display: none;">
				<i class="fas fa-spinner fa-spin me-2"></i>
				{{ 'auth.login.signing_in'|trans }}
			</span>
		</button>

		<!-- Additional Security Note -->
		<div class="text-center mt-3">
			<small class="text-muted">
				<i class="fas fa-shield-alt me-1"></i>
				{{ 'auth.login.ssl_security'|trans }}
			</small>
		</div>
	</form>
{% endblock %}


{% block javascripts %}
	<script>
		document.addEventListener('DOMContentLoaded', function () {
const form = document.getElementById('loginForm');
const submitBtn = document.getElementById('submitBtn');
const submitText = submitBtn.querySelector('.submit-text');
const loadingText = submitBtn.querySelector('.loading-text');

// Form validation
form.addEventListener('submit', function (event) {
if (! form.checkValidity()) {
event.preventDefault();
event.stopPropagation();

// Add shake effect to form
form.classList.add('was-validated');
form.style.animation = 'shake 0.5s ease-in-out';

setTimeout(() => {
form.style.animation = '';
}, 500);
} else { // Show loading state
submitText.style.display = 'none';
loadingText.style.display = 'inline';
submitBtn.disabled = true;
}
});

// Real-time validation
const inputs = form.querySelectorAll('input[required]');
inputs.forEach(input => {
input.addEventListener('blur', function () {
if (this.value.trim() === '') {
this.classList.add('is-invalid');
} else {
this.classList.remove('is-invalid');
this.classList.add('is-valid');
}
});

input.addEventListener('input', function () {
if (this.classList.contains('is-invalid') && this.value.trim() !== '') {
this.classList.remove('is-invalid');
this.classList.add('is-valid');
}
});
});


});


// Keyboard shortcuts
document.addEventListener('keydown', function (event) { // Enter key submits form when focused on inputs
if (event.key === 'Enter' && event.target.tagName === 'INPUT') {
const form = event.target.closest('form');
if (form) {
form.dispatchEvent(new Event('submit'));
}
}

// Escape key clears form
if (event.key === 'Escape') {
const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="password"]');
inputs.forEach(input => {
if (input.value) {
input.value = '';
input.classList.remove('is-valid', 'is-invalid');
}
});
}
});

// Add shake animation CSS
const style = document.createElement('style');
style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            
            .form-control.is-valid {
                border-color: #28a745;
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='m2.3 6.73.54.54L7.5 4.67l-3.2-3.2L2.3 3.47l2 2z'/%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right calc(0.375em + 0.1875rem) center;
                background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
            }
            
            .form-control.is-invalid {
                border-color: #dc3545;
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 3.6 2.4 2.4m-2.4 0 2.4-2.4'/%3e%3c/svg%3e");
                background-repeat: no-repeat;
                background-position: right calc(0.375em + 0.1875rem) center;
                background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);
            }
        `;
document.head.appendChild(style);
	</script>
{% endblock %}
